vars: {
  d2-config: {
    layout-engine: elk
    theme-id: 200
    sketch: true
    pad: 20
  }
  primary: "#3b82f6"
  primary-light: "#60a5fa"
  bg-dark: "#0f172a"
  bg-node: "#1e293b"
  border-node: "#334155"
  text-main: "#f1f5f9"
  text-accent: "#93c5fd"
}

classes: {
  box_node: {
    style: {
      font-size: 18
      stroke-width: 1
      border-radius: 6
      fill: ${bg-node}
      stroke: ${border-node}
      font-color: ${text-main}
    }
  }
  accent_node: {
    style: {
      font-size: 18
      stroke-width: 2
      border-radius: 6
      fill: ${bg-dark}
      stroke: ${primary}
      font-color: ${text-accent}
    }
  }
  container_box: {
    style: {
      fill: ${bg-dark}
      stroke: ${bg-node}
      stroke-dash: 0
      border-radius: 12
    }
  }
}

direction: down

User: "Staff Member" {
  shape: person
  style: {
    fill: ${primary}
    stroke: ${primary-light}
  }
}

Edge: "Edge Node (Pi2)" {
  class: container_box
  Reader: "NFC Reader" { class: box_node }
  Logic: "Python Service" {
    class: accent_node
    shape: hexagon
  }
  Reader -> Logic: "UID Scan" { 
    style: { stroke: ${primary}; stroke-width: 2 } 
  }
}

Cloud: "Cloud Backend" {
  class: container_box
  GAS: "API Gateway (GAS)" { class: box_node }
  Sheets: "Database (Google Sheets)" { 
    shape: cylinder
    class: box_node 
  }
  GAS -> Sheets: "Sync" { style: { stroke: ${primary} } }
}

Kiosk: "Dashboard (Old Laptop)" {
  class: container_box
  Webhook: "Discord Webhook" { 
    class: box_node
    shape: cloud 
  }
  Display: "Kiosk View" { class: box_node }
  Webhook -> Display: "Real-time UI" { style: { stroke: ${primary} } }
}

User -> Edge.Reader: "NFC Tap" {
  style: { 
    stroke: ${primary}
    stroke-width: 3
    animated: true 
  }
}

Edge.Logic -> Cloud.GAS: "HTTPS POST" {
  style: { 
    stroke: ${primary}
    stroke-dash: 4
    animated: true 
  }
}

Edge.Logic -> Kiosk.Webhook: "JSON Payload" {
  style: { 
    stroke: ${primary}
    stroke-dash: 4
    animated: true 
  }
}
